skill_id: onepassword_integration
name: Secure 1Password Vault Integration for JARVIS
description: Secure integration with 1Password allowing JARVIS to access a dedicated vault for service authentication while maintaining strict security boundaries and vault isolation
category: medium
version: 1.0.0
dependencies:
  - onepassword
  - cryptography
  - keyring
  - asyncio
  - pydantic
  - httpx
  - base64

api_requirements:
  onepassword_api:
    provider: 1password
    service_account_token_env_var: OP_SERVICE_ACCOUNT_TOKEN
    vault_id_env_var: OP_JARVIS_VAULT_ID
    vault_name: JARVIS-Services
    api_version: v1
    endpoint: https://my.1password.com/api
    restricted_access: true
  onepassword_cli:
    provider: 1password
    cli_path: op
    session_management: true
    biometric_unlock: false
    vault_restriction: single_vault_only
  encryption_service:
    provider: internal
    key_derivation: pbkdf2
    encryption_algorithm: aes_256_gcm
    secure_storage: system_keyring

inputs:
  action:
    type: string
    required: true
    allowed_values: [authenticate, get_credential, store_credential, update_credential, list_services, test_connection, rotate_tokens, audit_access]
    description: 1Password integration action to perform
  credential_request:
    type: object
    required: false
    properties:
      service_name:
        type: string
        required: true
        description: Name of the service requiring authentication
      credential_type:
        type: string
        enum: [api_key, oauth_token, username_password, certificate, ssh_key]
        default: api_key
      field_names:
        type: array
        items:
          type: string
        description: Specific fields to retrieve
      vault_item_title:
        type: string
        description: Title of the item in 1Password
      fallback_env_var:
        type: string
        description: Environment variable fallback if 1Password fails
  credential_storage:
    type: object
    required: false
    properties:
      service_name:
        type: string
        required: true
      credentials:
        type: object
        required: true
      item_title:
        type: string
      category:
        type: string
        enum: [login, secure_note, api_credential, database]
        default: api_credential
      tags:
        type: array
        items:
          type: string
      notes:
        type: string
      auto_fill_urls:
        type: array
  security_settings:
    type: object
    required: false
    properties:
      session_timeout:
        type: integer
        default: 3600
        description: Session timeout in seconds
      max_retry_attempts:
        type: integer
        default: 3
      encryption_at_rest:
        type: boolean
        default: true
      audit_logging:
        type: boolean
        default: true
      biometric_required:
        type: boolean
        default: false
      network_restrictions:
        type: array
  vault_access:
    type: object
    required: false
    properties:
      vault_id:
        type: string
        description: Specific vault ID (must be JARVIS vault)
      access_level:
        type: string
        enum: [read_only, read_write]
        default: read_only
      item_filters:
        type: object
      excluded_categories:
        type: array
        default: [identity, credit_card, secure_note]
      allowed_tags:
        type: array
        default: [jarvis, automation, api]
  integration_config:
    type: object
    required: false
    properties:
      auto_authentication:
        type: boolean
        default: true
      credential_caching:
        type: boolean
        default: true
      cache_duration:
        type: integer
        default: 1800
      refresh_threshold:
        type: integer
        default: 300
      background_refresh:
        type: boolean
        default: true
      failure_notifications:
        type: boolean
        default: true

outputs:
  authentication_result:
    type: object
    properties:
      authenticated:
        type: boolean
      session_id:
        type: string
      session_expires:
        type: string
      vault_access_granted:
        type: boolean
      available_items:
        type: integer
      last_authentication:
        type: string
  credential_data:
    type: object
    properties:
      service_name:
        type: string
      credential_type:
        type: string
      fields:
        type: object
        description: Encrypted credential fields
      metadata:
        type: object
      last_updated:
        type: string
      expires_at:
        type: string
      source:
        type: string
  storage_result:
    type: object
    properties:
      stored_successfully:
        type: boolean
      item_id:
        type: string
      vault_location:
        type: string
      encryption_status:
        type: string
      access_permissions:
        type: array
  service_inventory:
    type: array
    items:
      type: object
      properties:
        service_name:
          type: string
        credential_type:
          type: string
        last_accessed:
          type: string
        status:
          type: string
        auto_refresh_enabled:
          type: boolean
        expires_soon:
          type: boolean
  security_audit:
    type: object
    properties:
      vault_integrity:
        type: boolean
      access_log:
        type: array
      unauthorized_attempts:
        type: integer
      credential_health:
        type: object
      compliance_status:
        type: object
      recommendations:
        type: array
  connection_status:
    type: object
    properties:
      api_accessible:
        type: boolean
      cli_available:
        type: boolean
      vault_accessible:
        type: boolean
      response_time:
        type: number
      last_successful_connection:
        type: string
      error_details:
        type: string
  token_rotation:
    type: object
    properties:
      tokens_rotated:
        type: array
      rotation_successful:
        type: boolean
      next_rotation_date:
        type: string
      services_updated:
        type: array
      failed_rotations:
        type: array

execution:
  type: python_function
  entry_point: manage_onepassword_integration
  timeout: 60
  retry_attempts: 3
  async_processing: true
  secure_memory: true

security_architecture:
  vault_isolation:
    dedicated_vault: JARVIS-Services
    vault_restrictions: single_vault_access_only
    cross_vault_prevention: true
    access_boundary_enforcement: true
  authentication:
    service_account: true
    token_based: true
    session_management: true
    automatic_logout: true
    biometric_support: false
  encryption:
    transit_encryption: tls_1_3
    at_rest_encryption: aes_256_gcm
    key_derivation: pbkdf2_sha256
    secure_memory_handling: true
  access_control:
    principle_of_least_privilege: true
    role_based_access: false
    time_based_access: true
    ip_restrictions: false

credential_management:
  supported_types:
    api_keys:
      storage_format: secure_field
      auto_rotation: false
      expiry_monitoring: true
    oauth_tokens:
      storage_format: json_secure
      auto_refresh: true
      scope_validation: true
    username_password:
      storage_format: login_item
      password_strength_check: true
      breach_monitoring: false
    certificates:
      storage_format: document
      expiry_alerts: true
      chain_validation: false
  caching_strategy:
    memory_cache: true
    disk_cache: false
    cache_encryption: true
    cache_invalidation: time_based
    max_cache_size: 10mb

integration_features:
  skill_integration:
    automatic_credential_injection: true
    skill_authentication_helper: true
    batch_credential_retrieval: true
    dependency_mapping: true
  monitoring:
    access_logging: true
    usage_analytics: true
    performance_monitoring: true
    security_alerts: true
  automation:
    scheduled_token_refresh: true
    health_checks: true
    automatic_fallbacks: true
    credential_validation: true

compliance_privacy:
  data_protection:
    gdpr_compliance: true
    data_minimization: true
    purpose_limitation: true
    retention_policies: true
  audit_trail:
    comprehensive_logging: true
    tamper_evidence: true
    log_encryption: true
    retention_period: 1_year
  security_standards:
    zero_trust: true
    defense_in_depth: true
    secure_by_default: true
    regular_security_reviews: true

disaster_recovery:
  fallback_mechanisms:
    environment_variables: true
    secure_config_files: true
    manual_intervention: true
    degraded_mode_operation: true
  backup_strategies:
    credential_export: false
    configuration_backup: true
    access_history_backup: true
    secure_recovery_procedures: true

error_handling:
  authentication_failure: Fall back to environment variables and notify user of 1Password connection issue
  vault_access_denied: Log security event and switch to manual credential input mode
  network_connectivity: Use cached credentials if available and queue refresh for later
  rate_limiting: Implement exponential backoff and credential caching
  credential_not_found: Check alternative field names and provide clear error messaging
  session_expired: Automatically re-authenticate and retry operation
  vault_locked: Notify user and provide manual unlock instructions

performance_optimization:
  connection_pooling: true
  request_batching: true
  intelligent_caching: true
  lazy_loading: true
  background_refresh: true